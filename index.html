<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>üåø Advanced Nursery ‚Äî Enhanced</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <h1>üåø Advanced Nursery</h1>
    <div class="top-actions">
      <input id="globalSearch" placeholder="Search plants, species, tags..." aria-label="Search plants" />
      <select id="filterType" title="Filter type" aria-label="Filter by plant type">
        <option value="all">All types</option>
      </select>
      <button id="openAuth" class="btn">Login / Register</button>
      <button id="themeToggle" class="btn secondary">Dark</button>
      <button id="openCart" class="btn">Cart (<span id="cartCount">0</span>)</button>
      <button id="openProfile" class="btn secondary" style="display:none">Profile</button>
      <button id="openSellerDashboard" class="btn secondary" style="display:none">Seller Dashboard</button>
      <button id="openAdminPanel" class="btn secondary" style="display:none">Admin Panel</button>
    </div>
  </header>

  <main id="mainView" class="container">
    <aside class="filters">
      <h3>Filters</h3>
      <div id="tagList" class="tag-list"></div>

      <h4>Type</h4>
      <div id="typeList" class="tag-list"></div>

      <h4>Price</h4>
      <input id="priceMin" type="number" placeholder="Min" aria-label="Minimum price" />
      <input id="priceMax" type="number" placeholder="Max" aria-label="Maximum price" />

      <h4>Sort</h4>
      <select id="sortBy" aria-label="Sort plants by">
        <option value="name">Name</option>
        <option value="price">Price (asc)</option>
        <option value="stock">Stock (desc)</option>
      </select>
    </aside>

    <section class="catalog">
      <div id="plantsGrid" class="grid" aria-live="polite"></div>
      <div style="text-align:center;margin:16px 0">
        <button id="loadMore" class="btn secondary">Load more</button>
      </div>
    </section>
  </main>

  <!-- Auth modal -->
  <div id="authModal" class="panel hidden" aria-hidden="true" role="dialog" aria-labelledby="authTitle">
    <div class="panel-header">
      <h2 id="authTitle">Login / Register</h2>
      <button id="closeAuth" class="btn secondary">Close</button>
    </div>
    <div class="panel-body">
      <label for="authRole">Select role</label>
      <select id="authRole" aria-label="Select user role">
        <option value="customer">Customer</option>
        <option value="seller">Seller</option>
        <option value="admin">Admin</option>
      </select>

      <div style="margin-top:8px">
        <input id="a_email" placeholder="Email or phone" aria-label="Email or phone" />
        <input id="a_password" placeholder="Password" type="password" aria-label="Password" />
        <input id="a_name" placeholder="Full name (for register)" aria-label="Full name" />
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="btnLogin" class="btn">Login</button>
          <button id="btnRegister" class="btn secondary">Register</button>
        </div>
      </div>

      <div style="margin-top:8px;font-size:13px;color:#666">
        Tip: For admin login choose <strong>Admin</strong> and enter password <strong>DT2025</strong>.
      </div>
    </div>
  </div>

  <!-- Cart / Profile panel -->
  <div id="cartPanel" class="panel hidden" role="dialog" aria-labelledby="cartTitle">
    <div class="panel-header">
      <h2 id="cartTitle">Cart</h2>
      <button id="closeCart" class="btn secondary">Close</button>
    </div>
    <div class="panel-body">
      <div id="cartMain"></div>
    </div>
  </div>

  <div id="profilePanel" class="panel hidden" role="dialog" aria-labelledby="profileTitle">
    <div class="panel-header">
      <h2 id="profileTitle">Profile</h2>
      <button id="closeProfile" class="btn secondary">Close</button>
    </div>
    <div class="panel-body">
      <div id="profileMain"></div>
    </div>
  </div>

  <!-- Seller Dashboard -->
  <div id="sellerPanel" class="panel hidden" role="dialog" aria-labelledby="sellerTitle">
    <div class="panel-header">
      <h2 id="sellerTitle">Seller Dashboard</h2>
      <button id="closeSeller" class="btn secondary">Close</button>
    </div>
    <div class="panel-body">
      <div id="sellerMain">
        <h3>My Products</h3>
        <button id="addNewProduct" class="btn">Add New Product</button>
        <div id="sellerProducts" class="list" style="margin-top:16px"></div>
        
        <h3 style="margin-top:24px">Sales Analytics</h3>
        <div id="sellerAnalytics">
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; margin-top: 12px;">
            <div class="stat-card">
              <strong id="totalProducts">0</strong>
              <div>Total Products</div>
            </div>
            <div class="stat-card">
              <strong id="totalSales">0</strong>
              <div>Total Sales</div>
            </div>
            <div class="stat-card">
              <strong id="lowStock">0</strong>
              <div>Low Stock</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel" class="panel hidden" role="dialog" aria-labelledby="adminTitle">
    <div class="panel-header">
      <h2 id="adminTitle">Admin Panel</h2>
      <button id="closeAdmin" class="btn secondary">Close</button>
    </div>
    <div class="panel-body">
      <div id="adminMain">
        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
          <button class="admin-tab active" data-tab="users">Users</button>
          <button class="admin-tab" data-tab="products">Products</button>
          <button class="admin-tab" data-tab="orders">Orders</button>
        </div>
        
        <div id="adminUsers" class="admin-tab-content">
          <h3>User Management</h3>
          <div id="usersList" class="list"></div>
        </div>
        
        <div id="adminProducts" class="admin-tab-content hidden">
          <h3>Product Management</h3>
          <div id="productsList" class="list"></div>
        </div>
        
        <div id="adminOrders" class="admin-tab-content hidden">
          <h3>Order Management</h3>
          <div id="ordersList" class="list"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Product Form Modal -->
  <div id="productFormModal" class="panel hidden" role="dialog" aria-labelledby="productFormTitle">
    <div class="panel-header">
      <h2 id="productFormTitle">Add/Edit Product</h2>
      <button id="closeProductForm" class="btn secondary">Close</button>
    </div>
    <div class="panel-body">
      <form id="productForm">
        <input type="hidden" id="productId" />
        <div class="form-col">
          <label for="p_name">Plant Name</label>
          <input id="p_name" required aria-required="true" />
        </div>
        <div class="form-col">
          <label for="p_species">Species</label>
          <input id="p_species" />
        </div>
        <div class="form-col">
          <label for="p_price">Price (‚Çπ)</label>
          <input id="p_price" type="number" min="0" step="0.01" required aria-required="true" />
        </div>
        <div class="form-col">
          <label for="p_stock">Stock</label>
          <input id="p_stock" type="number" min="0" required aria-required="true" />
        </div>
        <div class="form-col">
          <label for="p_type">Type</label>
          <select id="p_type">
            <option value="trees">Trees</option>
            <option value="indoor">Indoor</option>
            <option value="herbs">Herbs</option>
            <option value="flowers">Flowers</option>
            <option value="succulents">Succulents</option>
          </select>
        </div>
        <div class="form-col">
          <label for="p_tags">Tags (comma separated)</label>
          <input id="p_tags" placeholder="medicinal, shade, air-purifying" />
        </div>
        <div class="form-col">
          <label for="p_info">Description</label>
          <textarea id="p_info" rows="3"></textarea>
        </div>
        <div class="form-col">
          <label for="p_image">Image URL</label>
          <input id="p_image" type="url" />
        </div>
        <div style="margin-top: 16px;">
          <button type="submit" class="btn">Save Product</button>
          <button type="button" id="deleteProduct" class="btn secondary" style="display:none">Delete Product</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Detail view -->
  <main id="detailView" class="detail" style="display:none">
    <a href="#" id="backLink">‚Üê Back to catalog</a>
    <h2 id="d_name"></h2>
    <p id="d_species" style="color:#556"></p>
    <div style="display:flex;gap:18px;align-items:flex-start;margin-top:12px">
      <img id="d_img" src="" alt="" style="width:320px;height:220px;object-fit:cover;border-radius:8px;background:#eef" />
      <div style="flex:1">
        <p id="d_info"></p>
        <p class="price" id="d_price"></p>
        <p class="stock" id="d_stock"></p>

        <div style="margin-top:12px">
          <label for="qtyNow" style="display:block;margin-bottom:4px">Quantity</label>
          <input id="qtyNow" type="number" min="1" value="1" style="width:80px;margin-right:8px" aria-label="Quantity" />
          <button id="addToCartNow" class="btn">Add to cart</button>
          <button id="reserveNow" class="btn secondary">Reserve</button>
        </div>

        <div class="reviews">
          <h3>Reviews</h3>
          <div id="reviewsList"></div>
          <div style="margin-top:8px">
            <input id="rev_name" placeholder="Your name" aria-label="Your name" />
            <textarea id="rev_text" placeholder="Write a review" aria-label="Review text"></textarea>
            <div style="display:flex;gap:8px;margin-top:6px">
              <button id="rev_save" class="btn">Post Review</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Optional fallback dataset -->
  <script src="app-fallback.js"></script>
  <!-- Modules -->
  <script type="module" src="js/utils.js"></script>
  <script type="module" src="js/auth.js"></script>
  <script type="module" src="js/cart.js"></script>
  <script type="module" src="js/plants.js"></script>
  <script type="module" src="js/orders.js"></script>
  <script type="module" src="js/seller.js"></script>
  <script type="module" src="js/admin.js"></script>
  <script type="module" src="js/main.js"></script>
</body>
</html>